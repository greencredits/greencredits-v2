<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" type="image/svg+xml" href="/favicon.svg">
    <title>Zone Officer Dashboard - GreenCredits</title>
    <!-- Font Awesome -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: 'Segoe UI', system-ui, sans-serif;
            background: #f3f4f6;
            color: #1f2937;
        }

        /* Sidebar & Layout */
        .dashboard-container {
            display: flex;
            min-height: 100vh;
        }

        .sidebar {
            width: 260px;
            background: #111827;
            color: white;
            padding: 20px;
            display: flex;
            flex-direction: column;
        }

        .logo {
            font-size: 1.5rem;
            font-weight: bold;
            color: #10b981;
            margin-bottom: 40px;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .nav-links {
            list-style: none;
            flex: 1;
        }

        .nav-links li {
            margin-bottom: 10px;
        }

        .nav-links a {
            display: flex;
            align-items: center;
            gap: 10px;
            padding: 12px 15px;
            color: #9ca3af;
            text-decoration: none;
            border-radius: 8px;
            transition: all 0.2s;
        }

        .nav-links a:hover,
        .nav-links a.active {
            background: #374151;
            color: white;
        }

        .user-profile {
            padding-top: 20px;
            border-top: 1px solid #374151;
            display: flex;
            align-items: center;
            gap: 10px;
        }

        .user-avatar {
            width: 40px;
            height: 40px;
            background: #10b981;
            border-radius: 50%;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: bold;
        }

        .user-info h4 {
            font-size: 0.9rem;
        }

        .user-info p {
            font-size: 0.8rem;
            color: #9ca3af;
        }

        /* Main Content */
        .main-content {
            flex: 1;
            padding: 30px;
            overflow-y: auto;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 30px;
        }

        .header h1 {
            font-size: 1.8rem;
        }

        .date-badge {
            background: white;
            padding: 8px 16px;
            border-radius: 20px;
            font-size: 0.9rem;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }

        /* Stats Grid */
        .stats-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(240px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }

        .stat-card {
            background: white;
            padding: 25px;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            display: flex;
            align-items: center;
            gap: 20px;
        }

        .stat-icon {
            width: 50px;
            height: 50px;
            border-radius: 10px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-size: 1.5rem;
        }

        .bg-blue {
            background: #dbeafe;
            color: #2563eb;
        }

        .bg-yellow {
            background: #fef3c7;
            color: #d97706;
        }

        .bg-green {
            background: #d1fae5;
            color: #059669;
        }

        .bg-purple {
            background: #ede9fe;
            color: #7c3aed;
        }

        .stat-details h3 {
            font-size: 2rem;
            font-weight: bold;
        }

        .stat-details p {
            color: #6b7280;
            font-size: 0.9rem;
        }

        /* Content Sections */
        .section-title {
            font-size: 1.2rem;
            margin-bottom: 20px;
            display: flex;
            justify-content: space-between;
            align-items: center;
        }

        .card {
            background: white;
            border-radius: 12px;
            box-shadow: 0 2px 10px rgba(0, 0, 0, 0.05);
            overflow: hidden;
        }

        /* Table */
        table {
            width: 100%;
            border-collapse: collapse;
        }

        th,
        td {
            padding: 15px 25px;
            text-align: left;
            border-bottom: 1px solid #f3f4f6;
        }

        th {
            background: #f9fafb;
            font-weight: 600;
            color: #6b7280;
            font-size: 0.9rem;
        }

        td {
            font-size: 0.95rem;
        }

        .status-badge {
            padding: 4px 12px;
            border-radius: 20px;
            font-size: 0.8rem;
            font-weight: 600;
        }

        .status-pending {
            background: #fef3c7;
            color: #92400e;
        }

        .status-in-progress {
            background: #dbeafe;
            color: #1e40af;
        }

        .status-resolved {
            background: #d1fae5;
            color: #065f46;
        }

        .status-rejected {
            background: #fee2e2;
            color: #991b1b;
        }

        .action-btn {
            background: #f3f4f6;
            border: none;
            padding: 6px 12px;
            border-radius: 6px;
            cursor: pointer;
            transition: all 0.2s;
            font-size: 0.85rem;
        }

        .action-btn:hover {
            background: #e5e7eb;
        }

        .action-btn.primary {
            background: #10b981;
            color: white;
        }

        .action-btn.primary:hover {
            background: #059669;
        }

        /* Modal */
        .modal {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            width: 100%;
            height: 100%;
            background: rgba(0, 0, 0, 0.5);
            z-index: 1000;
            align-items: center;
            justify-content: center;
        }

        .modal.active {
            display: flex;
        }

        .modal-content {
            background: white;
            padding: 30px;
            border-radius: 12px;
            width: 100%;
            max-width: 500px;
        }

        .modal-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 20px;
        }

        .form-group {
            margin-bottom: 15px;
        }

        .form-group label {
            display: block;
            margin-bottom: 5px;
            font-weight: 500;
        }

        .form-group select,
        .form-group textarea {
            width: 100%;
            padding: 10px;
            border: 1px solid #d1d5db;
            border-radius: 6px;
        }

        .btn-close {
            background: none;
            border: none;
            font-size: 1.5rem;
            cursor: pointer;
        }
    </style>
</head>

<body>
    <div class="dashboard-container">
        <!-- Sidebar -->
        <aside class="sidebar">
            <div class="logo">
                <i class="fas fa-leaf"></i> GreenCredits
            </div>
            <ul class="nav-links">
                <li>
                    <a href="#" onclick="showSection('dashboard')" class="active" id="nav-dashboard">
                        <i class="fas fa-chart-line"></i> Dashboard
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('reports')" id="nav-reports">
                        <i class="fas fa-clipboard-list"></i> Reports
                    </a>
                </li>
                <li>
                    <a href="#" onclick="showSection('my-team')" id="nav-team">
                        <i class="fas fa-users"></i> My Team
                    </a>
                </li>
            </ul>
            <div class="user-profile">
                <div class="user-avatar" id="officerAvatar">OJ</div>
                <div class="user-info">
                    <h4 id="officerName">Officer Name</h4>
                    <p id="officerZone">Loading Zone...</p>
                </div>
            </div>
            <button onclick="logout()"
                style="margin-top: 10px; background: #374151; color: white; border: none; padding: 8px; border-radius: 6px; cursor: pointer;">Logout</button>
        </aside>

        <!-- Main Content -->
        <main class="main-content">
            <header class="header">
                <div>
                    <h1>Zone Dashboard</h1>
                    <p class="text-gray-500">Manage waste reports and field workers</p>
                </div>
                <div class="date-badge" id="currentDate"></div>
            </header>

            <!-- Stats -->
            <div class="stats-grid" id="dashboardStats">
                <div class="stat-card">
                    <div class="stat-icon bg-blue"><i class="fas fa-clipboard"></i></div>
                    <div class="stat-details">
                        <h3 id="statTotal">0</h3>
                        <p>Total Reports</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-yellow"><i class="fas fa-clock"></i></div>
                    <div class="stat-details">
                        <h3 id="statPending">0</h3>
                        <p>Pending Review</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-purple"><i class="fas fa-tools"></i></div>
                    <div class="stat-details">
                        <h3 id="statInProgress">0</h3>
                        <p>In Progress</p>
                    </div>
                </div>
                <div class="stat-card">
                    <div class="stat-icon bg-green"><i class="fas fa-check-circle"></i></div>
                    <div class="stat-details">
                        <h3 id="statResolved">0</h3>
                        <p>Resolved</p>
                    </div>
                </div>
            </div>

            <!-- Reports Table -->
            <div id="reportsSection">
                <div class="section-title">
                    <h2>Recent Reports</h2>
                    <div class="filters">
                        <select id="statusFilter" onchange="filterReports()"
                            style="padding: 6px; border-radius: 6px; border: 1px solid #ccc;">
                            <option value="all">All Status</option>
                            <option value="pending">Pending</option>
                            <option value="in-progress">In Progress</option>
                            <option value="resolved">Resolved</option>
                        </select>
                    </div>
                </div>

                <div class="card">
                    <table>
                        <thead>
                            <tr>
                                <th>ID</th>
                                <th>Description</th>
                                <th>Location</th>
                                <th>Status</th>
                                <th>Assigned To</th>
                                <th>Action</th>
                            </tr>
                        </thead>
                        <tbody id="reportsTableBody">
                            <tr>
                                <td colspan="6" style="text-align: center;">Loading reports...</td>
                            </tr>
                        </tbody>
                    </table>
                </div>
            </div>

            <!-- My Team Section -->
            <div id="myTeamSection" style="display: none;">
                <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px;">
                    <h2>My Field Warriors</h2>
                    <button onclick="openAddWorkerModal()" class="action-btn primary">
                        <i class="fas fa-plus"></i> Add Worker
                    </button>
                </div>
                <div class="card">
                    <div id="workersTable">Loading team...</div>
                </div>
            </div>
        </main>
    </div>

    <!-- Assign Worker Modal -->
    <div class="modal" id="assignModal">
        <div class="modal-content">
            <div class="modal-header">
                <h3>Assign Report</h3>
                <button class="btn-close" onclick="closeModal('assignModal')">&times;</button>
            </div>
            <form id="assignForm" onsubmit="handleAssign(event)">
                <input type="hidden" id="assignReportId">
                <div class="form-group">
                    <label>Select Worker</label>
                    <select id="workerSelect" required>
                        <option value="">Loading workers...</option>
                    </select>
                </div>
                <div class="form-group">
                    <label>Instructions (Optional)</label>
                    <textarea id="assignNotes" rows="3"
                        placeholder="Add specific instructions for the worker..."></textarea>
                </div>
                <button type="submit" class="action-btn primary" style="width: 100%; padding: 12px;">Assign
                    Task</button>
            </form>
        </div>
    </div>

    <!-- Report Details Modal -->
    <div class="modal" id="detailsModal">
        <div class="modal-content" style="max-width: 600px;">
            <div class="modal-header">
                <h3>Report Details</h3>
                <button class="btn-close" onclick="closeModal('detailsModal')">&times;</button>
            </div>
            <div id="detailsContent">
                <!-- Populated dynamically -->
            </div>
        </div>
    </div>

    <!-- Add Worker Modal -->
    <div id="addWorkerModal" class="modal">
        <div class="modal-content">
            <h3 style="margin-bottom: 20px;">Recruit New Worker</h3>
            <form id="addWorkerForm" onsubmit="handleAddWorker(event)">
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 0.9em; color: #666;">Full Name</label>
                    <input type="text" id="workerName" required
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 0.9em; color: #666;">Mobile
                        Number</label>
                    <input type="text" id="workerMobile" required
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;"
                        placeholder="10-digit number">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 0.9em; color: #666;">Password</label>
                    <input type="password" id="workerPassword" required
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 0.9em; color: #666;">Assign to
                        Zone</label>
                    <input type="text" id="workerZone" readonly
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px; background: #f3f4f6; color: #666;">
                </div>
                <div style="margin-bottom: 15px;">
                    <label style="display: block; margin-bottom: 5px; font-size: 0.9em; color: #666;">Address
                        (Optional)</label>
                    <input type="text" id="workerAddress"
                        style="width: 100%; padding: 10px; border: 1px solid #ddd; border-radius: 6px;">
                </div>
                <div style="display: flex; gap: 10px; margin-top: 20px;">
                    <button type="button" onclick="closeModal('addWorkerModal')"
                        style="flex: 1; padding: 10px; border: 1px solid #ddd; background: white; border-radius: 6px; cursor: pointer;">Cancel</button>
                    <button type="submit"
                        style="flex: 1; padding: 10px; border: none; background: #10b981; color: white; border-radius: 6px; cursor: pointer;">Hired!</button>
                </div>
            </form>
        </div>
    </div>

    <script>
        // State
        let currentOfficer = null;
        let reports = [];
        let workers = []; // This will now hold the workers managed by this officer

        // Initialization
        document.addEventListener('DOMContentLoaded', () => {
            const date = new Date().toLocaleDateString('en-IN', { weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' });
            document.getElementById('currentDate').textContent = date;

            checkAuth();
        });

        function showSection(section) {
            // Hide all main content sections
            document.getElementById('dashboardStats').style.display = 'none';
            document.getElementById('reportsSection').style.display = 'none';
            document.getElementById('myTeamSection').style.display = 'none';

            // Show the selected section
            if (section === 'dashboard') {
                document.getElementById('dashboardStats').style.display = 'grid';
                document.getElementById('reportsSection').style.display = 'block';
                loadDashboardData(); // Reload reports and stats
            } else if (section === 'reports') {
                document.getElementById('reportsSection').style.display = 'block';
                loadDashboardData(); // Reload reports and stats
            } else if (section === 'my-team') {
                document.getElementById('myTeamSection').style.display = 'block';
                loadMyWorkers(); // Load workers for this section
            }

            // Update active nav link
            document.querySelectorAll('.nav-links a').forEach(a => a.classList.remove('active'));
            document.getElementById('nav-' + section).classList.add('active');
        }

        async function checkAuth() {
            try {
                const response = await fetch('/api/officer/me'); // Changed to officer specific API
                const data = await response.json();

                if (data.success && data.officer) { // Changed from data.admin to data.officer
                    currentOfficer = data.officer;
                    updateProfileUI();
                    loadDashboardData(); // Load initial dashboard data
                } else {
                    window.location.href = '/officer-login.html';
                }
            } catch (error) {
                console.error('Auth error:', error);
                window.location.href = '/officer-login.html';
            }
        }

        function updateProfileUI() {
            document.getElementById('officerName').textContent = currentOfficer.name;
            document.getElementById('officerZone').textContent = currentOfficer.assignedZones.join(', ');
            document.getElementById('officerAvatar').textContent = currentOfficer.name.substring(0, 2).toUpperCase();
        }

        async function loadDashboardData() {
            try {
                // Load Reports
                const reportsRes = await fetch('/api/admin/reports'); // This API already filters by zone for officers
                const reportsData = await reportsRes.json();

                if (reportsData.success) {
                    reports = reportsData.reports;
                    renderReports();
                    updateStats();
                }

                // Load Workers (for assignment)
                const workersRes = await fetch('/api/officer/workers'); // Filtered by officer's zone
                const workersData = await workersRes.json();

                if (workersData.success) {
                    workers = workersData.workers;
                    updateWorkerDropdown();
                }

            } catch (error) {
                console.error('Data load error:', error);
            }
        }

        function updateStats() {
            document.getElementById('statTotal').textContent = reports.length;
            document.getElementById('statPending').textContent = reports.filter(r => r.status === 'pending').length;
            document.getElementById('statInProgress').textContent = reports.filter(r => r.status === 'in-progress').length;
            document.getElementById('statResolved').textContent = reports.filter(r => r.status === 'resolved').length;
        }

        function renderReports() {
            const tbody = document.getElementById('reportsTableBody');
            const filter = document.getElementById('statusFilter').value;

            const filteredReports = filter === 'all' ? reports : reports.filter(r => r.status === filter);

            if (filteredReports.length === 0) {
                tbody.innerHTML = '<tr><td colspan="6" style="text-align: center; padding: 30px;">No reports found.</td></tr>';
                return;
            }

            tbody.innerHTML = filteredReports.map(report => `
                <tr>
                    <td>#${report.reportId}</td>
                    <td>
                        <div style="font-weight: 500;">${report.description.substring(0, 40)}${report.description.length > 40 ? '...' : ''}</div>
                        <div style="font-size: 0.8rem; color: #6b7280;">${new Date(report.createdAt).toLocaleDateString()}</div>
                    </td>
                    <td>${report.address || 'GPS Location'}</td>
                    <td><span class="status-badge status-${report.status}">${report.status}</span></td>
                    <td>${report.assignedTo ? report.assignedTo.name : '<span style="color: #9ca3af;">Unassigned</span>'}</td>
                    <td>
                        <button class="action-btn" onclick="viewDetails('${report._id}')" style="margin-right: 5px;">View</button>
                        ${report.status === 'pending' || report.status === 'verified' ?
                    `<button class="action-btn primary" onclick="openAssignModal('${report._id}')">Assign</button>` : ''}
                        <button class="action-btn" style="background:#ef4444; color:white; margin-left:5px;" onclick="rejectReport('${report._id}')">Reject</button>
                    </td>
                </tr>
            `).join('');
        }

        function filterReports() {
            renderReports();
        }

        function updateWorkerDropdown() {
            const select = document.getElementById('workerSelect');
            select.innerHTML = '<option value="">Select a worker...</option>' +
                workers.map(w => `<option value="${w._id}">${w.name} (${w.assignedZone})</option>`).join('');
        }

        function openAssignModal(reportId) {
            document.getElementById('assignReportId').value = reportId;
            document.getElementById('assignModal').classList.add('active');
        }

        function viewDetails(reportId) {
            const report = reports.find(r => r._id === reportId);
            if (!report) return;

            const content = document.getElementById('detailsContent');

            let mapLink = '#';
            // Strict check for valid coordinates
            // Ensure we treat them as numbers even if they come as strings
            if (report.location &&
                report.location.coordinates &&
                Array.isArray(report.location.coordinates)) {

                const lng = parseFloat(report.location.coordinates[0]);
                const lat = parseFloat(report.location.coordinates[1]);

                if (!isNaN(lng) && !isNaN(lat) && (lat !== 0 || lng !== 0)) {
                    // Use 'q=lat,lng' format for pin drop
                    mapLink = `https://www.google.com/maps?q=${lat},${lng}`;
                } else if (report.address) {
                    mapLink = `https://www.google.com/maps?q=${encodeURIComponent(report.address)}`;
                }
            } else if (report.address) {
                mapLink = `https://www.google.com/maps?q=${encodeURIComponent(report.address)}`;
            }

            content.innerHTML = `
                <div style="display: flex; gap: 20px; flex-wrap: wrap;">
                    <div style="flex: 1; min-width: 250px;">
                        <img src="${report.photoUrl || '/leaf.jpg'}" alt="Report Photo" 
                            style="width: 100%; border-radius: 8px; border: 1px solid #ddd; max-height: 300px; object-fit: cover;">
                        ${report.completionPhotoUrl ?
                    `<div style="margin-top: 10px;">
                                <strong>âœ… Resolved Photo:</strong>
                                <img src="${report.completionPhotoUrl}" style="width: 100%; border-radius: 8px; margin-top: 5px; border: 2px solid #10b981;">
                             </div>` : ''}
                    </div>
                    <div style="flex: 1; min-width: 250px;">
                        <span class="status-badge status-${report.status}" style="margin-bottom: 10px; display: inline-block;">${report.status.toUpperCase()}</span>
                        <h4 style="margin: 10px 0 5px;">Description</h4>
                        <p style="color: #4b5563; margin-bottom: 15px;">${report.description}</p>
                        
                        <h4 style="margin: 0 0 5px;">Category</h4>
                        <p style="color: #4b5563; margin-bottom: 15px;">${report.category || 'General'}</p>

                        <h4 style="margin: 0 0 5px;">Location</h4>
                        <p style="color: #4b5563; margin-bottom: 5px;">${report.address || 'GPS Coordinates Only'}</p>
                        <a href="${mapLink}" target="_blank" class="action-btn primary" 
                           style="display: inline-flex; align-items: center; gap: 5px; text-decoration: none; margin-top: 5px;">
                           <i class="fas fa-map-marker-alt"></i> Open in Google Maps
                        </a>

                        <div style="margin-top: 20px; padding-top: 15px; border-top: 1px solid #eee;">
                            <p><small><strong>Reporter:</strong> ${report.userId ? report.userId.name : 'Anonymous'}</small></p>
                            <p><small><strong>Date:</strong> ${new Date(report.createdAt).toLocaleString()}</small></p>
                            ${report.assignedTo ? `<p><small><strong>Assigned Worker:</strong> ${report.assignedTo.name}</small></p>` : ''}
                        </div>
                    </div>
                </div>
            `;

            document.getElementById('detailsModal').classList.add('active');
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function handleAssign(e) {
            e.preventDefault();
            const reportId = document.getElementById('assignReportId').value;
            const workerId = document.getElementById('workerSelect').value;

            if (!workerId) return alert('Please select a worker');

            try {
                const response = await fetch(`/api/admin/reports/${reportId}/assign`, {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({ workerId })
                });

                const result = await response.json();
                if (result.success) {
                    alert('Task assigned successfully! ðŸš€');
                    closeModal('assignModal');
                    loadDashboardData(); // Refresh data
                } else {
                    alert('Error: ' + result.error);
                }
            } catch (error) {
                alert('Connection error');
            }
        }

        async function logout() {
            await fetch('/api/admin/logout', { method: 'POST' });
            window.location.href = '/officer-login.html';
        }

        // ==========================================
        // ðŸ‘· WORKER MANAGEMENT LOGIC
        // ==========================================
        async function loadMyWorkers() {
            try {
                const container = document.getElementById('workersTable');
                container.innerHTML = '<div style="text-align:center; padding:20px;">Loading team...</div>';

                const response = await fetch('/api/officer/workers');
                const data = await response.json();

                if (!data.success || data.workers.length === 0) {
                    container.innerHTML = '<div style="padding:30px; text-align:center; color:#666;">No warriors in your team yet.</div>';
                    return;
                }

                workers = data.workers; // Update global state

                let html = `
                <table>
                    <thead>
                        <tr>
                            <th>Name</th>
                            <th>Mobile</th>
                            <th>Status</th>
                            <th>Performance</th>
                        </tr>
                    </thead>
                    <tbody>
                `;

                workers.forEach(w => {
                    html += `
                    <tr>
                        <td>
                            <div style="font-weight:bold;">${w.name}</div>
                            <div style="font-size:0.8em; color:#666;">Joined: ${new Date(w.createdAt).toLocaleDateString()}</div>
                        </td>
                        <td>${w.mobile}</td>
                        <td><span class="status-badge status-${w.status}">${w.status}</span></td>
                        <td>
                            <div style="display:flex; align-items:center; gap:5px;">
                                <i class="fas fa-check-circle" style="color:#10b981;"></i>
                                <span>${w.totalReportsCompleted} Reports</span>
                            </div>
                        </td>
                    </tr>
                `;
                });
                html += '</tbody></table>';
                container.innerHTML = html;
            } catch (error) {
                console.error('Error loading workers:', error);
                document.getElementById('workersTable').innerHTML = 'Error loading data.';
            }
        }

        async function handleAddWorker(e) {
            e.preventDefault();
            const formData = {
                name: document.getElementById('workerName').value,
                mobile: document.getElementById('workerMobile').value,
                password: document.getElementById('workerPassword').value,
                zone: document.getElementById('workerZone').value,
                address: document.getElementById('workerAddress').value
            };

            try {
                const response = await fetch('/api/admin/create-worker', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify(formData)
                });
                const data = await response.json();

                if (data.success) {
                    alert('Worker hired successfully! ðŸŽ‰');
                    closeModal('addWorkerModal');
                    document.getElementById('addWorkerForm').reset();
                    loadMyWorkers(); // Refresh list
                    // Also refresh dropdown if we are on dashboard
                    loadDashboardData();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (error) {
                alert('Connection error');
            }
        }

        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }
        function closeModal(modalId) {
            document.getElementById(modalId).classList.remove('active');
        }

        async function rejectReport(id) {
            const reason = prompt("Reason for rejection (e.g. 'Fake', 'Duplicate'):");
            if (!reason) return;

            try {
                const res = await fetch('/api/universal/reject-report', {
                    method: 'POST',
                    headers: { 'Content-Type': 'application/json' },
                    body: JSON.stringify({
                        reportId: id,
                        reason: reason,
                        rejectedByRole: 'Officer',
                        rejectorId: currentOfficer._id
                    })
                });
                const data = await res.json();
                if (data.success) {
                    alert('Report rejected.');
                    loadDashboardData();
                } else {
                    alert('Error: ' + data.error);
                }
            } catch (e) { alert('Connection error'); }
        }
    </script>
    <script src="/socket.io/socket.io.js"></script>
    <script>
        const socket = io();
        socket.on('newReport', (report) => {
            // Refresh dashboard if new report comes in
            showNotification('New Report Received! ðŸ””', 'info');
            loadDashboardData();
        });

        function showNotification(message, type = 'info') {
            // Simple alert for now, or could implement toast like worker dashboard
            // reusing existing alert mechanism or simple console log/toast
            const toast = document.createElement('div');
            toast.style.cssText = `
                 position: fixed; bottom: 20px; right: 20px;
                 background: ${type === 'success' ? '#10b981' : '#3b82f6'};
                 color: white; padding: 15px 25px; border-radius: 8px;
                 box-shadow: 0 4px 12px rgba(0,0,0,0.15); z-index: 9999;
                 animation: slideIn 0.3s ease-out;
             `;
            toast.textContent = message;
            document.body.appendChild(toast);
            setTimeout(() => toast.remove(), 3000);
        }
    </script>
</body>

</html>